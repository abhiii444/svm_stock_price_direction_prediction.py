# -*- coding: utf-8 -*-
"""Support Vector Machine  .ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kgqwVt1arr2Zh7WEknPO5JCpcVuVvRPD

## Predicting Stock Price Direction Using Support Vector Machines
"""

from sklearn.svm import SVC
from sklearn.metrics import accuracy_score
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import warnings
warnings.filterwarnings ("ignore")

df = pd.read_csv('/content/drive/MyDrive/DATASET/RELIANCE.csv')
df.head()

"""## Step 3: Data Preparation

## The data needed to be processed before use such that the date column should act as an index to do that and will drop date column.
"""

#Changes The Data column as index columns
df.index= pd.to_datetime(df['Date'])
df
df=df.drop(['Date'],axis='columns')
df

"""## Step 4: Define the explanatory variables
The X is a dataset that holds the variables which are used for prediction. The X consists of variables such as 'Open - Close' and 'High - Low'. These can be understood as indicators based on which the algorithm will predict tomorrow's trend.
"""

# Create predictor variables
df['Open-Close'] = df.Open - df.Close
df['High - Low'] = df.High - df.Low

# Store all predictor variables in a variable X
X = df[[ 'Open-Close', 'High - Low']]
X.head()

"""## Step 5: Define the target variable
The X is a dataset that holds the variables which are used for prediction. The X consists of variables such as 'Open - Close' and 'High - Low'. These can be understood as indicators based on which the algorithm will predict tomorrow's trend.
"""

# Target Variables
y = np.where(df['Close'].shift(-1)>df['Close'],1,0)
y

"""## Step 6: Split the data into train and test

"""

split_perentage = 0.8
split = int( split_perentage*len(df))

# Train data set
X_train = X[:split]
y_train = y[:split]

# Test data set
X_test = X[split:]
y_test = y[split :]

"""## Step 7: Support Vector Classifier (SVC)"""

# Support Vector Classifier
cls = SVC().fit(X_train, y_train)

"""## Step 8: Classifier accuracy"""

print("The data was split into training and testing sets using an 80/20 split.")

# Calculate training accuracy
train_accuracy = accuracy_score(y_train, cls.predict(X_train))

# Calculate Testing Accuarcy
test_accuracy = accuracy_score(y_test, cls.predict(X_test))

print(f"Training Accuarcy:{train_accuracy}")
print(f"Testing Accuarcy:{test_accuracy} ")

"""## Step 9: Different Kernels"""

from sklearn.metrics import accuracy_score

 # Linear Kernel
cls_linear = SVC(kernel='linear').fit(X_train, y_train)
y_pred_linear = cls_linear.predict(X_test)
accuracy_linear = accuracy_score(y_test, y_pred_linear)
print(f"Accuracy with linear kernel: {accuracy_linear}")

# Polynomial kernel
cls_poly = SVC(kernel = 'poly', degree=3).fit(X_train, y_train)
y_pred_poly = cls_poly.predict(X_test)
accuracy_poly = accuracy_score(y_test, y_pred_poly)
print(f"Accuracy with Polynomial Kernel(degree=3) : {accuracy_poly}")

# RBF kernal
cls_rbf = SVC(kernel='rbf').fit(X_train, y_train)
y_pred_rbf = cls_rbf.predict(X_test)
accuracy_rbf = accuracy_score(y_test, y_pred_rbf)
print(f"Accuracy with RBF kernel: {accuracy_rbf}")

# Sigmoid kernal
cls_sigmoid = SVC(kernel='sigmoid').fit(X_train, y_train)
y_pred_sigmoid = cls_sigmoid.predict(X_test)
accuracy_sigmoid = accuracy_score(y_test, y_pred_sigmoid)
print(f"Accuracy with Sigmoid kernel: {accuracy_sigmoid}")

"""## Step 10 : Strategy implementation"""

df['Predicted_Signal'] = cls.predict(X)

#  Calculate daily returns
df['Return'] = df.Close.pct_change()

##  Calculate Strategy returns
df['Strategy_Return']=df.Return *df.Predicted_Signal.shift(1)

#  Calculate Cumulutive  returns
df['Cum_Ret'] = df['Return'].cumsum()
df

# Plot Strategy Cumculative returns
df['Cum_Strategy'] = df ['Strategy_Return'].cumsum()
df

"""## Step 11 : Visualizing Strategy Returns vs Original Returns"""

# Commented out IPython magic to ensure Python compatibility.
import matplotlib.pyplot as plt
# %matplotlib inline

plt.plot(df['Cum_Ret'],color ='red')
plt.plot(df['Cum_Strategy'],color ='blue')